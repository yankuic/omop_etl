insert into [DWS_OMOP].[stage].[MEASUREMENT_LAB] with (tablock)SELECT  dbo.ALL_PATIENTS.PATNT_KEY,  PATNT_ENCNTR_KEY_XREF1.PATNT_ENCNTR_KEY,  dbo.LAB_RESULT_DTL.NORML_LOW,  dbo.LAB_RESULT_DTL.NORML_HIGH,  ALL_LOINC_CODES_INFERRED.LOINC_CD,  dbo.LAB_RESULT_DTL.LAB_UNIT,  dbo.LAB_RESULT_DTL.LAB_RESULT,  dbo.ORDER_PROCEDURE_DTL.SPECMN_TKN_DATE,  dbo.ORDER_PROCEDURE_DTL.SPECMN_TKN_TIME,  dbo.ORDER_PROCEDURE_DTL.SPECMN_TKN_DT,  dbo.LAB_RESULT_DTL.RESOLVED_DATE,  dbo.LAB_RESULT_DTL.RESOLVED_TIME,  dbo.LAB_RESULT_DTL.RESOLVED_DT,  ALL_PROVIDERS_AUTH_LAB.PROVIDR_KEY INTO #TempTableFROM  dbo.ALL_PROVIDERS ALL_PROVIDERS_AUTH_LAB RIGHT OUTER JOIN dbo.ORDER_PROCEDURE_DTL ON (ALL_PROVIDERS_AUTH_LAB.PROVIDR_KEY=dbo.ORDER_PROCEDURE_DTL.AUTH_PROVIDR_KEY)  RIGHT OUTER JOIN dbo.PATIENT_ENCOUNTER_DTL ON (dbo.PATIENT_ENCOUNTER_DTL.PATNT_ENCNTR_KEY=dbo.ORDER_PROCEDURE_DTL.PATNT_ENCNTR_KEY AND dbo.PATIENT_ENCOUNTER_DTL.TEST_IND='N' )  LEFT OUTER JOIN dbo.ALL_PATIENT_SNAPSHOTS ALL_PT_SNAPSHOTS_ENCOUNTER ON (ALL_PT_SNAPSHOTS_ENCOUNTER.PATNT_SNAPSHT_KEY=dbo.PATIENT_ENCOUNTER_DTL.DSCHRG_PATNT_SNAPSHT_KEY AND dbo.PATIENT_ENCOUNTER_DTL.TEST_IND='N' )  LEFT OUTER JOIN dbo.ALL_PATIENTS ON (ALL_PT_SNAPSHOTS_ENCOUNTER.PATNT_KEY=dbo.ALL_PATIENTS.PATNT_KEY)  LEFT OUTER JOIN dbo.PATNT_ENCNTR_KEY_XREF PATNT_ENCNTR_KEY_XREF1 ON (dbo.PATIENT_ENCOUNTER_DTL.PATNT_ENCNTR_KEY=PATNT_ENCNTR_KEY_XREF1.PATNT_ENCNTR_KEY AND dbo.PATIENT_ENCOUNTER_DTL.TEST_IND='N' )  LEFT OUTER JOIN dbo.LAB_RESULT_DTL ON (dbo.LAB_RESULT_DTL.ORDR_PROC_KEY=dbo.ORDER_PROCEDURE_DTL.ORDR_PROC_KEY)  LEFT OUTER JOIN dbo.ALL_LABS ALL_LABS1 ON (dbo.LAB_RESULT_DTL.LAB_KEY=ALL_LABS1.LAB_KEY)  LEFT OUTER JOIN dbo.ALL_LOINC_CODES ALL_LOINC_CODES_INFERRED ON (ALL_LOINC_CODES_INFERRED.LOINC_CD_KEY=ALL_LABS1.INFERRED_LOINC_CD_KEY)  LEFT OUTER JOIN ALL_LAB_STATUSES ON (ALL_LAB_STATUSES.LAB_STAT_CD_KEY=dbo.LAB_RESULT_DTL.LAB_STAT_CD_KEY)  WHERE  (  dbo.ALL_PATIENTS.PATNT_KEY IN ( 3432956,4469754,3931319,271306,260570,5421300 )  AND  ALL_LAB_STATUSES.STNDRD_LABEL IN ( 'EDITED','EDITED FINAL','FINAL' )  AND  dbo.LAB_RESULT_DTL.RESOLVED_DATE >= '01/01/2020 00:0:0'  AND  ALL_LOINC_CODES_INFERRED.LOINC_CD NOT IN ( '??' )  AND  ( dbo.ALL_PATIENTS.TEST_IND='N' )  )



 DROP TABLE IF EXISTS #TempTable

SELECT  DISTINCT  top 100 dbo.ALL_PATIENTS.PATNT_KEY,  PATNT_ENCNTR_KEY_XREF1.PATNT_ENCNTR_KEY,  Flowsheet_Enc_Dttime_ROTHMAN.MEASR_TAKN_DATE,  Flowsheet_Enc_Dttime_ROTHMAN.MEASR_TAKN_DT,  Flowsheet_ROTHMAN_SCORE.MEASR_VALUE,  ALL_PROVIDERS_PT_IND.PROVIDR_KEY,  ALL_PROVIDERS_VISIT.PROVIDR_KEY 
INTO #TempTable
FROM  dbo.ALL_PATIENTS RIGHT OUTER JOIN dbo.ALL_PATIENT_SNAPSHOTS ALL_PT_SNAPSHOTS_ENCOUNTER ON (ALL_PT_SNAPSHOTS_ENCOUNTER.PATNT_KEY=dbo.ALL_PATIENTS.PATNT_KEY)  RIGHT OUTER JOIN dbo.PATIENT_ENCOUNTER_DTL ON (ALL_PT_SNAPSHOTS_ENCOUNTER.PATNT_SNAPSHT_KEY=dbo.PATIENT_ENCOUNTER_DTL.DSCHRG_PATNT_SNAPSHT_KEY AND dbo.PATIENT_ENCOUNTER_DTL.TEST_IND='N'  )  LEFT OUTER JOIN dbo.PATNT_ENCNTR_KEY_XREF PATNT_ENCNTR_KEY_XREF1 ON (dbo.PATIENT_ENCOUNTER_DTL.PATNT_ENCNTR_KEY=PATNT_ENCNTR_KEY_XREF1.PATNT_ENCNTR_KEY AND dbo.PATIENT_ENCOUNTER_DTL.TEST_IND='N'  )  LEFT OUTER JOIN (  SELECT DISTINCT a.LINK_PATNT_ENCNTR_KEY,a.PATNT_ENCNTR_KEY,a.MEASR_TAKN_DT,a.MEASR_TAKN_DATE    FROM flowsheet_measure_dtl a join all_flowsheet_measures b on a.flowsht_measr_key=b.flowsht_measr_key  where b.ETL_IND = 'Y' and a.MEASR_VALUE is not null  and b.STNDRD_LABEL_CAT is not null  ) Flowsheet_Enc_Dttime ON (dbo.PATIENT_ENCOUNTER_DTL.TEST_IND='N'   AND dbo.PATIENT_ENCOUNTER_DTL.PATNT_ENCNTR_KEY=Flowsheet_Enc_Dttime.LINK_PATNT_ENCNTR_KEY)  LEFT OUTER JOIN (  SELECT DISTINCT a.PATNT_ENCNTR_KEY,a.MEASR_TAKN_DT,a.MEASR_TAKN_DATE FROM flowsheet_measure_dtl a join all_flowsheet_measures b  on(a.flowsht_measr_key=b.flowsht_measr_key) where b.stndrd_label_cat in('ROTHMAN') and a.measr_value is not null  ) Flowsheet_Enc_Dttime_ROTHMAN ON (Flowsheet_Enc_Dttime.PATNT_ENCNTR_KEY=Flowsheet_Enc_Dttime_ROTHMAN.PATNT_ENCNTR_KEY AND Flowsheet_Enc_Dttime.MEASR_TAKN_DT=Flowsheet_Enc_Dttime_ROTHMAN.MEASR_TAKN_DT)  LEFT OUTER JOIN (  select a.*   from flowsheet_measure_dtl a join all_flowsheet_measures b on (a.flowsht_measr_key=b.flowsht_measr_key)   where b.stndrd_label_dtl = 'ROTHMAN SCORE'  ) Flowsheet_ROTHMAN_SCORE ON (Flowsheet_Enc_Dttime_ROTHMAN.PATNT_ENCNTR_KEY=Flowsheet_ROTHMAN_SCORE.PATNT_ENCNTR_KEY AND Flowsheet_Enc_Dttime_ROTHMAN.MEASR_TAKN_DT=Flowsheet_ROTHMAN_SCORE.MEASR_TAKN_DT)  LEFT OUTER JOIN PATIENT_ENCOUNTER_DAILY_SUMMARY ON (dbo.PATIENT_ENCOUNTER_DTL.TEST_IND='N'   AND PATIENT_ENCOUNTER_DAILY_SUMMARY.PATNT_ENCNTR_KEY=dbo.PATIENT_ENCOUNTER_DTL.PATNT_ENCNTR_KEY)  LEFT OUTER JOIN dbo.ALL_PROVIDERS ALL_PROVIDERS_PT_IND ON (PATIENT_ENCOUNTER_DAILY_SUMMARY.ATTND_PROVIDR_KEY=ALL_PROVIDERS_PT_IND.PROVIDR_KEY)  LEFT OUTER JOIN dbo.ALL_PROVIDERS ALL_PROVIDERS_VISIT ON (dbo.PATIENT_ENCOUNTER_DTL.TEST_IND='N'   AND dbo.PATIENT_ENCOUNTER_DTL.VISIT_PROVIDR_KEY=ALL_PROVIDERS_VISIT.PROVIDR_KEY)  
where dbo.ALL_PATIENTS.PATNT_KEY in ('3432956','4469754','3931319','271306','260570','5421300' )

SELECT 
    c.name 'Column Name',
    t.Name 'Data type',
    c.max_length 'Max Length',
    c.precision ,
    c.scale ,
    c.is_nullable
FROM    
    tempdb.sys.columns  c
INNER JOIN 
    sys.types t ON c.user_type_id = t.user_type_id

WHERE
    c.object_id = OBJECT_ID(N'tempdb..#TempTable')